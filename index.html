<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    #canvas {
      background: green;
      display: block;
    }

    body {
      margin: 0;
      padding: 0;
    }

    .actions {
      position: fixed;
      bottom: 0;
      left: 0;
    }

    .actions>#brush {
      display: none;
    }

    .actions.x>#brush {
      display: inline-block;
    }

    .actions.x>#eraser {
      display: none;
    }
  </style>
</head>

<body>
  <canvas id="canvas" width=900 height="900">

  </canvas>
  <div id="actions" class="actions">
    <button id="eraser">橡皮擦</button>
    <button id="brush">画笔</button>
  </div>
  <script>
    canvas = document.getElementById('canvas');
    var context = canvas.getContext('2d');
    autoSetCanvasSize(canvas);

    listenToUser(canvas);

    var eraserEnabled = false;
    eraser.onclick = function () {
      eraserEnabled = true;
      actions.className = "actions x"
    }

    brush.onclick = function () {
      eraserEnabled = false;
      actions.className = "actions"
    }
    function listenToUser(canvas) {
      var using = false;
      var lastPoint = { x: undefined, y: undefined }
      //特性侦测
      if (document.body.ontouchstart !== undefined) {
        //触屏设备
        canvas.ontouchstart = function (e) {
          var x = e.touches[0].clientX;
          var y = e.touches[0].clientY;
          using = true;
          if (eraserEnabled) {
            context.clearRect(x - 5, y - 5, 10, 10)
          } else {
            lastPoint = { x: x, y: y };
          }
        }

        canvas.ontouchmove = function (e) {
          var x = e.touches[0].clientX;
          var y = e.touches[0].clientY;
          if (!using) { return }
          if (eraserEnabled) {
            context.clearRect(x - 5, y - 5, 10, 10)
          } else {
            var newPoint = { x: x, y: y }
            drawLine(lastPoint.x, lastPoint.y, newPoint.x, newPoint.y)
            lastPoint = newPoint
          }
        }

        canvas.ontouchend = function (e) {
          using = false;
        }
      } else {
        canvas.onmousedown = function (e) {
          var x = e.clientX;
          var y = e.clientY;
          using = true;
          if (eraserEnabled) {
            context.clearRect(x - 5, y - 5, 10, 10)
          } else {
            lastPoint = { x: x, y: y };
          }
        }
        canvas.onmousemove = function (e) {
          var x = e.clientX;
          var y = e.clientY;
          if (!using) { return }
          if (eraserEnabled) {
            context.clearRect(x - 5, y - 5, 10, 10)
          } else {
            var newPoint = { x: x, y: y }
            drawLine(lastPoint.x, lastPoint.y, newPoint.x, newPoint.y)
            lastPoint = newPoint
          }
        }
        canvas.onmouseup = function (e) {
          using = false;
        }
      }

    }
    function drawLine(x1, y1, x2, y2) {
      context.beginPath();
      context.strokeStyle = 'black'
      context.moveTo(x1, y1)
      context.lineWidth = 5
      context.lineTo(x2, y2)
      context.stroke()
      context.closePath()
    }

    function autoSetCanvasSize(canvas) {
      setCanvasSize();
      window.onresize = function () {
        setCanvasSize();
      }
      function setCanvasSize() {
        var pageWidth = document.documentElement.clientWidth;
        var pageHeight = document.documentElement.clientHeight;
        canvas.width = pageWidth;
        canvas.height = pageHeight;
      }
    }

  </script>
</body>

</html>